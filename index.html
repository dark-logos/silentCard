<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>День Рождения в стиле Silent Hill</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/8.0.0/pixi.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #000;
      height: 100vh;
      overflow: hidden;
      font-family: 'Courier New', monospace;
    }
    .slide {
      display: none;
      position: absolute;
      top: 20px;
      left: 20px;
      color: #fff;
      font-size: 16px;
      white-space: pre-wrap;
    }
    .slide.active {
      display: block !important;
    }
    .letter {
      display: inline-block;
      animation: flicker 0.1s infinite;
    }
    @keyframes flicker {
      0% { opacity: 1; }
      50% { opacity: 0.8; }
      100% { opacity: 1; }
    }
    #slide4 {
      width: 100%;
      height: 100%;
      display: none;
    }
    #pixi-container {
      width: 100%;
      height: 100%;
    }
    #nextSlideButton {
      position: absolute;
      top: 100px;
      left: 20px;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
      animation: pulse 1s infinite;
      z-index: 10;
    }
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }
  </style>
</head>
<body>
  <div id="slide1" class="slide active"></div>
  <div id="slide2" class="slide"></div>
  <div id="slide3" class="slide"></div>
  <div id="slide4" class="slide">
    <div id="pixi-container"></div>
  </div>
  <div id="slide5" class="slide"></div>

  <!-- Audio -->
  <audio id="breathing" loop>
    <source src="breathing.mp3" type="audio/mp3">
  </audio>
  <audio id="water" loop>
    <source src="water.mp3" type="audio/mp3">
  </audio>
  <audio id="chains">
    <source src="chains.mp3" type="audio/mp3">
  </audio>

  <script>
    const slide1Text = "Вот и настал этот день>>>";
    const slide2Text = "всегда казалось странным праздновать начало, почему никто не говорит о завершении? ведь оно и есть глоток нового для существа обреченного на смерть.";
    const slide3Text = "для существа обреченного на смерть.";
    const slide5Text = "было бы так просто.";

    function typeText(element, text, speed, callback) {
      let i = 0;
      element.innerHTML = "";
      function type() {
        if (i < text.length) {
          element.innerHTML += `<span class="letter">${text.charAt(i)}</span>`;
          i++;
          setTimeout(type, speed);
        } else {
          callback();
        }
      }
      type();
    }

    function showSlide1() {
      const slide1 = document.getElementById("slide1");
      typeText(slide1, slide1Text, 50, () => {
        const nextButton = document.createElement("div");
        nextButton.id = "nextSlideButton";
        nextButton.textContent = "Далее ➤";
        nextButton.addEventListener("click", showSlide2);
        slide1.appendChild(nextButton);
      });
    }

    function showSlide2() {
      document.getElementById("slide1").classList.remove("active");
      const slide2 = document.getElementById("slide2");
      slide2.classList.add("active");
      typeText(slide2, slide2Text, 50, () => {
        const nextButton = document.createElement("div");
        nextButton.id = "nextSlideButton";
        nextButton.textContent = "Далее ➤";
        nextButton.addEventListener("click", showSlide3);
        slide2.appendChild(nextButton);
      });
    }

    function showSlide3() {
      document.getElementById("slide2").classList.remove("active");
      const slide3 = document.getElementById("slide3");
      slide3.classList.add("active");
      typeText(slide3, slide3Text, 50, () => {
        const nextButton = document.createElement("div");
        nextButton.id = "nextSlideButton";
        nextButton.textContent = "Далее ➤";
        nextButton.addEventListener("click", showSlide4);
        slide3.appendChild(nextButton);
      });
    }

    function showSlide4() {
      document.getElementById("slide3").classList.remove("active");
      document.getElementById("slide4").classList.add("active");
      startGame();
    }

    function showSlide5() {
      document.getElementById("slide4").classList.remove("active");
      const slide5 = document.getElementById("slide5");
      slide5.classList.add("active");
      typeText(slide5, slide5Text, 50, () => {
        const nextButton = document.createElement("div");
        nextButton.id = "nextSlideButton";
        nextButton.textContent = "Далее ➤";
        slide5.appendChild(nextButton);
      });
    }

    function startGame() {
      const breathingSound = document.getElementById("breathing");
      const waterSound = document.getElementById("water");
      const chainsSound = document.getElementById("chains");

      const app = new PIXI.Application({
        resizeTo: window,
        backgroundColor: 0x000000,
      });
      document.getElementById("pixi-container").appendChild(app.view);

      const container = new PIXI.Container();
      app.stage.addChild(container);

      const loader = PIXI.Loader.shared;
      loader
        .add("feet", "feet.png")
        .add("eyes", "eyes.png")
        .add("fog", "fog.png")
        .load(setup);

      let gameState = "waiting";
      let symbolShown = false;
      let running = false;
      let fogSprite, fogAlpha = 0;
      let time = 0;

      function setup() {
        breathingSound.play().catch(() => {});
        waterSound.play().catch(() => {});

        const feet = new PIXI.Sprite(loader.resources.feet.texture);
        feet.anchor.set(0.5, 0);
        feet.x = app.screen.width / 2;
        feet.y = app.screen.height - 140;
        feet.alpha = 0.8;
        container.addChild(feet);

        const eyes = new PIXI.Sprite(loader.resources.eyes.texture);
        eyes.anchor.set(0.5);
        eyes.x = app.screen.width / 2 + 150;
        eyes.y = app.screen.height / 2 - 100;
        eyes.alpha = 0;
        container.addChild(eyes);

        fogSprite = new PIXI.Sprite(loader.resources.fog.texture);
        fogSprite.width = app.screen.width;
        fogSprite.height = app.screen.height;
        fogSprite.alpha = 0;
        container.addChild(fogSprite);

        app.stage.interactive = true;
        app.stage.on("pointerdown", () => {
          if (gameState === "waiting") {
            gameState = "walking";
            setTimeout(() => {
              eyes.alpha = 1;
              chainsSound.play().catch(() => {});
              symbolShown = true;
            }, 4000);
            setTimeout(() => {
              running = true;
            }, 6000);
            setTimeout(() => {
              fogAlpha = 0.01;
            }, 8500);
            setTimeout(() => {
              breathingSound.pause();
              waterSound.pause();
              showSlide5();
            }, 10000);
          }
        });

        app.ticker.add((delta) => {
          time += delta;

          if (running) {
            container.x = -Math.sin(time * 0.1) * 4;
          }

          if (fogAlpha > 0 && fogSprite.alpha < 1) {
            fogSprite.alpha += 0.01;
          }
        });
      }
    }

    // Старт
    showSlide1();
  </script>
</body>
</html>
